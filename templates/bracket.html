{% extends "base.html" %}

{% block title %}Tournament Bracket - World Cup 2026 Scorer{% endblock %}

{% block extra_css %}
<style>
    .bracket-container {
        overflow-x: auto;
        padding: 2rem 0;
    }
    
    .bracket {
        display: flex;
        gap: 3rem;
        min-width: max-content;
    }
    
    .bracket-round {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        min-width: 220px;
    }
    
    .round-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.2rem;
        color: var(--accent-gold);
        text-align: center;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--border);
        margin-bottom: 1rem;
    }
    
    .bracket-match {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
    }
    
    .bracket-team {
        padding: 0.75rem 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border);
    }
    
    .bracket-team:last-child {
        border-bottom: none;
    }
    
    .bracket-team.winner {
        background: rgba(0, 210, 106, 0.1);
    }
    
    .bracket-team.winner .team-name {
        color: var(--accent-green);
        font-weight: 600;
    }
    
    .bracket-team.loser {
        opacity: 0.5;
    }
    
    .team-name {
        font-size: 0.9rem;
    }
    
    .team-score {
        font-family: 'Bebas Neue', sans-serif;
        color: var(--accent-gold);
    }
    
    .bracket-empty {
        background: rgba(0,0,0,0.2);
        border: 1px dashed var(--border);
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.85rem;
    }
    
    /* Visual bracket lines */
    .bracket-connector {
        position: relative;
    }
    
    /* Top teams seeding */
    .seeding-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .seed-item {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 0.5rem 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
    }
    
    .seed-item.eliminated {
        opacity: 0.4;
    }
    
    .seed-number {
        font-family: 'Bebas Neue', sans-serif;
        color: var(--accent-gold);
        width: 24px;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Tournament Bracket</h2>
    <p>Knockout stage visualization</p>
</div>

{% if current_round == 'Group Stage' %}
<div class="card" style="text-align: center; padding: 3rem;">
    <h3 style="color: var(--accent-gold); margin-bottom: 1rem;">Group Stage in Progress</h3>
    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
        The bracket will be populated once teams advance to the knockout rounds.
    </p>
    <a href="{{ url_for('admin_advance_knockout') }}" class="btn btn-primary">
        Advance to Knockout
    </a>
</div>
{% else %}
<div class="bracket-container">
    <div class="bracket">
        {% for round_name in rounds %}
        <div class="bracket-round">
            <div class="round-title">{{ round_name }}</div>
            
            {% if bracket_data[round_name] %}
                {% for match in bracket_data[round_name] %}
                <div class="bracket-match">
                    {% if match.match_type == 'win' %}
                        {% set team1_is_winner = match.team1_id == match.winner_id %}
                        <div class="bracket-team {% if team1_is_winner %}winner{% else %}loser{% endif %}">
                            <span class="team-name">{{ match.team1.country }}</span>
                            <span class="team-score">{% if team1_is_winner %}W{% endif %}</span>
                        </div>
                        <div class="bracket-team {% if not team1_is_winner %}winner{% else %}loser{% endif %}">
                            <span class="team-name">{{ match.team2.country }}</span>
                            <span class="team-score">{% if not team1_is_winner %}W{% endif %}</span>
                        </div>
                    {% else %}
                        <div class="bracket-team">
                            <span class="team-name">{{ match.team1.country }}</span>
                            <span class="team-score">D</span>
                        </div>
                        <div class="bracket-team">
                            <span class="team-name">{{ match.team2.country }}</span>
                            <span class="team-score">D</span>
                        </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="bracket-empty">
                    No matches yet
                </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Team Seeding -->
<div class="card" style="margin-top: 2rem;">
    <div class="card-header">
        <h3 class="card-title">Team Seeding (by Total Score)</h3>
    </div>
    
    <div class="seeding-grid">
        {% for team in teams %}
        <div class="seed-item {% if team.eliminated %}eliminated{% endif %}">
            <span>
                <span class="seed-number">{{ loop.index }}</span>
                {{ team.country }}
            </span>
            <span style="color: var(--accent-green);">{{ "%.1f"|format(team.total_score) }}</span>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Knockout Results Summary -->
{% if current_round != 'Group Stage' %}
<div class="card" style="margin-top: 2rem;">
    <div class="card-header">
        <h3 class="card-title">Knockout Stage Summary</h3>
    </div>
    
    <div class="grid grid-3">
        {% for round_name in rounds %}
        <div style="background: rgba(0,0,0,0.2); border-radius: 8px; padding: 1rem; text-align: center;">
            <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.5rem;">{{ round_name }}</div>
            <div style="font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: var(--accent-gold);">
                {{ bracket_data[round_name]|length }} matches
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
